import:
  - recipe/common.php

config:
  repository: 'git@github.com:visavi/motor.git'
  shared_files:
    - .env
  shared_dirs:
    - public/uploads
    - storage
  writable_dirs:
    - public/uploads/*
    - storage/*

hosts:
  motorcms.ru:
    remote_user: www-data
    deploy_path: '/var/www/motorcms.ru'

tasks:
  deploy:
    - deploy:prepare
    - backup:create
    - migrate:up
    - deploy:vendors
    - deploy:publish

  backup:create:
    script:
      - '{{bin/php}} {{release_path}}/motor backup'

  migrate:up:
    script:
      - '{{bin/php}} {{release_path}}/motor migrate'

after:
  deploy:failed: deploy:unlock
